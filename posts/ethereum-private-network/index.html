<!doctype html><html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="おしんこのブログ">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:creator content="@osynco">
<meta name=twitter:site content="@osynco">
<meta property="twitter:title" content="Ethereum Private Network - Osync I/O">
<meta property="og:url" content="https://osync.io/posts/ethereum-private-network/">
<meta property="og:title" content="Ethereum Private Network - Osync I/O">
<meta property="og:description" content="スマートコントラクト (DApps) の開発を行うために、イーサリアムの公式 CLI である Geth を使用して、プライベートネットワークを構築していきます。 開発環境のディ">
<meta property="og:image" content="https://osync.io/images/headers/ethereum.png">
<title>Ethereum Private Network - Osync I/O</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JQCHZM9PGG"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JQCHZM9PGG',{anonymize_ip:!1})}</script>
<style>:root{--color-link:#499bea;--color-link-hover:#304999;--color-muted:#7d8590;--font-base:-apple-system, "BlinkMacSystemFont",
                   "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo,
                   sans-serif, "Segoe UI Emoji";--font-code:"SFMono-Regular", Consolas, "Liberation Mono", Menlo,
                   monospace, "Segoe UI Emoji";--header-grad-start:var(--color-link);--header-grad-end:var(--color-link-hover)}*,*::before,*::after{box-sizing:border-box}@font-face{font-family:flop;src:url(/fonts/flop/FLOPDesignFont.woff2)format("woff2"),url(/fonts/flop/FLOPDesignFont.woff)format("woff");font-weight:400}img{max-width:100%}body{margin:0;font-family:var(--font-base);background-color:#e7f4ff}a{color:var(--color-link);text-decoration:none}a:hover{color:var(--color-link-hover)}code{padding:.2em .4em;border-radius:6px;background-color:#818b981f;font-size:85%;font-family:var(--font-code)}pre code{border:1px solid #999;display:block;padding:1em;line-height:1.45em;overflow:auto;background-color:inherit;border-radius:0}header{padding:1em;background:linear-gradient(to top,var(--header-grad-start) 0%,var(--header-grad-end) 100%);color:#b6cee2;font-size:1.2em;text-align:center}header h1{margin:0 0 .4em;color:#fff;font-family:flop}header h1 a{color:inherit;text-decoration:none}header h1 a:hover{color:#b6cee2}header p{margin:0;font-size:.8em}nav{margin:1em}@media screen and (min-width:920px){nav{width:912px;margin-left:auto;margin-right:auto}}nav ul{margin:0;padding:0;list-style:none}nav li{display:inline;line-height:1.6;padding-bottom:.4em;border-bottom:2px solid #fff}nav li.selected{border-bottom:2px solid #cc0051}@media screen and (min-width:480px){main{margin:1em}}@media screen and (min-width:920px){main{width:920px;margin-left:auto;margin-right:auto}}.article-list{display:flex;flex-direction:column;gap:16px}@media screen and (min-width:920px){.article-list{flex-direction:row;flex-wrap:wrap}.article-wrapper.col2{width:448px}.article-wrapper.col4{width:216px}}article{margin:0;padding:1em;background-color:#fff}article h1{margin:0 0 .6em;font-size:1.5em}article h2{position:relative;padding:.6em 1em;background-color:#61a5e4;border-radius:7px;color:#fff;font-size:1.25em}article h2:after{position:absolute;content:'';top:100%;left:30px;border:8px solid transparent;border-top:8px solid #61a5e4;width:0;height:0}article h3{padding:.25em 0 .25em .6em;border-left:.4em solid var(--color-link);font-size:1.125em}article>ul{margin:.5em 0;padding:0;list-style:none;font-size:.8em}article>ul li{display:inline;line-height:1.6}article .date{display:flex;column-gap:1em;row-gap:.5em;flex-wrap:wrap;margin:0;font-size:.8em}article .date>*{display:flex;gap:.25em}article .date>*>:first-child:after{content:":"}section li{line-height:1.6}footer{margin:1em}footer ul{margin:0;padding:0;list-style:none;text-align:center}footer li{display:inline;line-height:1.6}footer small{display:block;margin:1em;text-align:center;color:#666}.responsive{position:relative;padding-bottom:75%}.responsive>*{position:absolute;top:0;left:0;width:100%;height:120%}ul.pagination{margin:1em 0;padding:0;font-family:Tahoma,Sans-Serif}ul.pagination li{display:inline;padding:.2em}blockquote{padding-left:1em;border-left:.25em solid #dfe2e5;color:var(--color-muted);margin:1em 0}table{border-collapse:collapse}table th,table td{padding:10px;border:1px solid #dfe2e5;text-align:left}table th{background-color:#eee;color:#24292e}.fade{transition:opacity .2s ease-in-out}.fade:hover{opacity:.5}</style>
</head>
<body>
<header>
<h1><a href=/>Osync I/O</a></h1>
<p>おしんこのブログ</p>
</header>
<nav>
<ul>
<li>
<a href=/posts/>Posts</a></li>
<li>
<a href=/tags/>Tags</a></li>
<li>
<a href=/about/>About</a></li>
</ul>
</nav>
<main>
<article>
<h1><a href=/posts/ethereum-private-network/>Ethereum Private Network</a></h1>
<div class=date>
<div>
<div>Last committed</div>
<time datetime=2022-06-18T00:24:12Z+0900>
22/06/18 00:24
</time>
</div>
<div>
<div>Posted</div>
<time datetime=2018-06-20T22:15:00Z+0900>
18/06/20 22:15
</time>
</div>
</div>
<ul>
<li><a href=/tags/ethereum/>Ethereum</a></li>
<li><a href=/tags/blockchain/>Blockchain</a></li>
</ul>
<img src=/images/headers/ethereum.png>
<section><p>スマートコントラクト (DApps) の開発を行うために、イーサリアムの公式 CLI である <a href=https://github.com/ethereum/go-ethereum>Geth</a> を使用して、プライベートネットワークを構築していきます。</p>
<h2 id=開発環境のディレクトリ構成>開発環境のディレクトリ構成</h2>
<p>このような環境を構築します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>tree -a
.
├── .ethereum-dev
│   ├── clients
│   │   └── <span style=color:#ae81ff>1</span>
│   └── miner
└── genesis.json
</code></pre></div><p>マイナーとその他のクライアントで分ける理由ですが、 geth コンソール上で開発とマイニングを同時に行うと Ether の送金やコントラクト実行のために消費される Gas コストなどが、同時に得られるマイニング報酬とごっちゃになり、確認しずらくなってしまうのを避けるためです。</p>
<h2 id=ネットワーク-id-を定義>ネットワーク ID を定義</h2>
<p>プライベートネットワークの ID を決めます。既知の値は避けてください。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>NETID<span style=color:#f92672>=</span><span style=color:#ae81ff>15</span>
</code></pre></div><h2 id=genesis-ブロックを定義>Genesis ブロックを定義</h2>
<p>始祖となるブロックを定義します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; genesis.json
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;config&#34;: {
</span><span style=color:#e6db74>    &#34;chainId&#34;: $NETID
</span><span style=color:#e6db74>  },
</span><span style=color:#e6db74>  &#34;nonce&#34;: &#34;0x0000000000000042&#34;,
</span><span style=color:#e6db74>  &#34;timestamp&#34;: &#34;0x0&#34;,
</span><span style=color:#e6db74>  &#34;parentHash&#34;: &#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;,
</span><span style=color:#e6db74>  &#34;extraData&#34;: &#34;&#34;,
</span><span style=color:#e6db74>  &#34;gasLimit&#34;: &#34;0x8000000&#34;,
</span><span style=color:#e6db74>  &#34;difficulty&#34;: &#34;0x4000&#34;,
</span><span style=color:#e6db74>  &#34;mixhash&#34;: &#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;,
</span><span style=color:#e6db74>  &#34;coinbase&#34;: &#34;0x3333333333333333333333333333333333333333&#34;,
</span><span style=color:#e6db74>  &#34;alloc&#34;: {}
</span><span style=color:#e6db74>}
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><h2 id=geth-を用意>Geth を用意</h2>
<p>macOS の場合は、公式ウォレットの <a href=https://github.com/ethereum/mist>Mist</a> に含まれる Geth を使います。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>geth<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> $HOME/Library/Application<span style=color:#ae81ff>\ </span>Support/Ethereum<span style=color:#ae81ff>\ </span>Wallet/binaries/Geth/unpacked/geth $*; <span style=color:#f92672>}</span>
</code></pre></div><h2 id=マイナーを初期化>マイナーを初期化</h2>
<p>データディレクトリを決めます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>DATA<span style=color:#f92672>=</span>$HOME/.ethereum-dev/miner
</code></pre></div><p>genesis.json より初期化します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>geth --datadir $DATA init genesis.json
</code></pre></div><h2 id=クライアントを初期化>クライアントを初期化</h2>
<p>データディレクトリを決めます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>DATA<span style=color:#f92672>=</span>$HOME/.ethereum-dev/clients/1
</code></pre></div><p>genesis.json より初期化します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>geth --datadir $DATA init genesis.json
</code></pre></div><p>一度起動してマイニング報酬の宛先となるアカウントを作成しておきます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>geth --datadir $DATA --networkid $NETID --port <span style=color:#ae81ff>30305</span> console 2&gt;&gt; $DATA/err.log
&gt; 
&gt; personal.newAccount<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>)</span>  // Create an empty password account
&gt; <span style=color:#e6db74>&#34;0x71efd180a2246663624a3e6f13da97b9315815f3&#34;</span>
&gt; exit
</code></pre></div><h2 id=マイニングを開始>マイニングを開始</h2>
<p>マイニング報酬の宛先をクライアントが持つアドレス指定して実行後、ログに出力されたノード情報をコピーします。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>ETHERBASE<span style=color:#f92672>=</span>0x71efd180a2246663624a3e6f13da97b9315815f3

geth --datadir $DATA --networkid $NETID --identity miner <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --port <span style=color:#ae81ff>30304</span> --lightserv <span style=color:#ae81ff>75</span> --lightpeers <span style=color:#ae81ff>10</span> --shh <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --mine --minerthreads <span style=color:#ae81ff>1</span> --etherbase $ETHERBASE <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --ipcpath geth.ipc
...
INFO <span style=color:#f92672>[</span>06-21|20:56:52<span style=color:#f92672>]</span> UDP listener up self<span style=color:#f92672>=</span>enode://84a278e86445104cb2552369acf31a5e6b74751fd9e57bffcaa8e89e65d63ec30ee560ba6e1ef1c312af0f7859c875b0ce043d066d33542e29a48813b2f9ba54@<span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:30304
...
</code></pre></div><h2 id=クライアントを起動>クライアントを起動</h2>
<p>マイナーのノード情報を <code>bootnodes</code> に指定して起動します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>MINERADDR<span style=color:#f92672>=</span>127.0.0.1

BOOTNODES<span style=color:#f92672>=</span>enode://84a278e86445104cb2552369acf31a5e6b74751fd9e57bffcaa8e89e65d63ec30ee560ba6e1ef1c312af0f7859c875b0ce043d066d33542e29a48813b2f9ba54@$MINERADDR:30304

geth --datadir $DATA --networkid $NETID --identity client <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --port <span style=color:#ae81ff>30305</span> --bootnodes $BOOTNODES --shh <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --rpc --rpcaddr 0.0.0.0 --rpcport <span style=color:#ae81ff>8104</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --ws --wsaddr 0.0.0.0 --wsport <span style=color:#ae81ff>8105</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     --ipcpath geth.ipc <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>     console 2&gt;&gt; $DATA/err.log
&gt; 
&gt; eth.blockNumber  // Check number
&gt; web3.fromWei<span style=color:#f92672>(</span>eth.getBalance<span style=color:#f92672>(</span>eth.coinbase<span style=color:#f92672>)</span>, <span style=color:#e6db74>&#39;ether&#39;</span><span style=color:#f92672>)</span>;
</code></pre></div><p>もしクライアントでマイニングをする場合、コンソール上で下記のようにします。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>miner</span>.<span style=color:#a6e22e>start</span>();

<span style=color:#75715e>// 採掘できるまでちょっと待つ
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>miner</span>.<span style=color:#a6e22e>stop</span>();
</code></pre></div><h2 id=おわりに>おわりに</h2>
<p>今回作成したネットワークは、 MetaMask を介して接続することも可能です。</p>
<p>この記事について、何か気になるところがあれば、チャットや SNS などでお気軽にご連絡ください。</p>
</section>
</article>
<script>var submittedMessage=!1;function handleMessageSubmit(b){b.target.querySelector('input[type="hidden"]').value=location.href;const a=confirm('メッセージを送信します。よろしいですか？');return b.target.querySelector('button').disabled=a,b.target.querySelector('textarea').readOnly=a,submittedMessage=a,a}</script>
<div style=margin-top:1em>
<form action=https://docs.google.com/forms/d/e/1FAIpQLSdNRP2vN3NEer3hwIrNEFIAf2dfNSzcwnd42tQYhkruGa7K_A/formResponse method=post onsubmit="return handleMessageSubmit(event)" target=hidden style=display:flex;flex-direction:column;gap:.75em>
<input type=hidden name=entry.1054445216>
<textarea name=entry.1359947595 placeholder=このページに関するご指摘・ご意見などを送信下さい。 rows=10 cols=40 maxlength=400 required style=padding:1em></textarea>
<button style="width:max-content;padding:.4em 1.5em">送信</button>
</form>
<iframe name=hidden style=display:none onload="submittedMessage&&alert('ご協力ありがとうございます。メッセージを送信しました。')"></iframe>
</div>
</main>
<footer>
<ul>
<li>
<a href=https://discord.gg/JhgFz8u>Discord</a>
<a href=https://github.com/oshinko>GitHub</a>
<a href=https://bsky.app/profile/osync.io>Bluesky</a>
<a href=https://snort.social/p/npub1xx3kyu57uqukvsxmlhnmafv825pct93455hkn544nd6exlnunxps2psn5q>Nostr</a>
</li>
</ul>
<small>
(C) 2025 Osync I/O.
Powered by <a href=https://gohugo.io>Hugo</a>.
</small>
</footer>
</body>
</html>